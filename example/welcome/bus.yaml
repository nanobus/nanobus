compute:
  type: mux
  with: {}

subscriptions:

  #- pubsub: pubsub
  #  topic: test_topic
  #  function: receiveMessage

resiliency:
  retries:
    pubsub:
      policy: constant
      duration: 3s

  circuitBreakers:
    pubsub:
      maxRequests: 2
      timeout: 30s

inbound:

  receiveMessage:
    summary: Receives the customer message
    actions:
      - summary: Routing messages
        name: route
        with:
          routes:
            - when: input.type == 'customer.created'
              then:
                - summary: Send to route
                  name: invoke
                  with:
                    function: welcome.v1.Inbound/greetCustomer
                    input: input.data
                  retry: pubsub
                  circuitBreaker: pubsub

outbound:

  'welcome.v1.Outbound':
    sendEmail:
      summary: Sends an email to the customer
      actions:
        - summary: Pretend to send an email by logging the message
          name: log
          with:
            format: "Sending email to %s with message %q"
            args:
              - input.email
              - input.message
